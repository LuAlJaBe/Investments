
{% extends 'landbot_base.html' %}


{% block title %} Bamba - Landbot Set up Campaigns {% endblock title %}
    
{% block content %}
{% if form.errors %}
    <p style="color: red;">
        Error validation field
    </p>
{% endif %}

<form class="setup_form border bg-slate-50 rounded border-gray-300 shadow-xl h-auto mx-auto p-4 flex flex-col" method="post" onkeydown="verify_not_empty_fields();">
    <h1 class="text-center text-3xl px-auto py-4">
        Set Up Campaigns
    </h1>
    {% csrf_token %}
    {{ form.management_form }}
    {% for fo in form %}
        <table>
            {{ fo.non_field_errors }}
            <tbody>
                <tr>
                    <th>
                        <label for="{{ fo.campaign_name.id_for_label }}">Campaign_name:</label>
                    </th>
                    <td>
                        {{ fo.campaign_name.errors }}
                        {{ fo.campaign_name }}
                    </td>
                </tr>
                <tr>
                    <th>
                        <label for="{{ fo.audience.id_for_label }}">Audience:</label>
                    </th>
                    <td>
                        {{ fo.audience.errors }}
                        {{ fo.audience }}
                    </td>
                </tr>
                <tr>
                    <th>
                        <label for="{{ fo.schedule.id_for_label }}">Schedule:</label>
                    </th>
                    <td>
                        {{ fo.schedule.errors }}
                        {{ fo.schedule }}
                    </td>
                </tr>
            </tbody>
        </table>
    {% endfor %}
    <div id="buttons-div" class="flex justify-end">
        <button id="setup_form_button" class="m-3 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l" type="button" onclick="add_form();">Add</button>
        <button class="m-3 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l" type="button" onclick="delete_form();">Delete</button>
        <button type="submit" class="m-3 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:cursor-not-allowed" disabled>Set Up</button>
    </div>
</form>

<script>
    function add_form(){
        let total_forms = document.querySelector('#id_form-TOTAL_FORMS');

        let container = document.createElement("table");
        let body = document.createElement("tbody");
        let campaign_namerow = document.createElement("tr");
        let campaign_namelabelcontainer = document.createElement("th");
        let campaign_namedatacontainer =document.createElement("td");
        let audiencerow = document.createElement("tr");
        let audiencelabelcontainer = document.createElement("th");
        let audiencedatacontainer =document.createElement("td");
        let schedulerow = document.createElement("tr");
        let schedulelabelcontainer = document.createElement("th");
        let scheduledatacontainer =document.createElement("td");

        let campaign_namelabel = document.createElement("label");
        let campaign_namedata = document.querySelector("#id_form-0-campaign_name").cloneNode(true);
        let audiencelabel = document.createElement("label");
        let audiencedata = document.querySelector("#id_form-0-audience").cloneNode(true);
        let schedulelabel = document.createElement("label");
        let scheduledata = document.querySelector("#id_form-0-schedule").cloneNode(true);

        campaign_namelabel.innerHTML = 'Campaign name:';
        campaign_namedata.name = 'form-'+total_forms.value+'-campaign_name';
        campaign_namedata.id = 'id_form-'+total_forms.value+'-campaign_name';
        audiencelabel.innerHTML = 'Audience:';
        audiencedata.name = 'form-'+total_forms.value+'-audience';
        audiencedata.id = 'id_form-'+total_forms.value+'-audience';
        schedulelabel.innerHTML = 'Schedule:';
        scheduledata.name = 'form-'+total_forms.value+'-schedule';
        scheduledata.id = 'id_form-'+total_forms.value+'-schedule';

        campaign_namelabelcontainer.appendChild(campaign_namelabel);
        campaign_namedatacontainer.appendChild(campaign_namedata);
        audiencelabelcontainer.appendChild(audiencelabel);
        audiencedatacontainer.appendChild(audiencedata);
        schedulelabelcontainer.appendChild(schedulelabel);
        scheduledatacontainer.appendChild(scheduledata);

        campaign_namerow.appendChild(campaign_namelabelcontainer)
        campaign_namerow.appendChild(campaign_namedatacontainer);
        audiencerow.appendChild(audiencelabelcontainer);
        audiencerow.appendChild(audiencedatacontainer);
        schedulerow.appendChild(schedulelabelcontainer);
        schedulerow.appendChild(scheduledatacontainer);

        body.appendChild(campaign_namerow);
        body.appendChild(audiencerow);
        body.appendChild(schedulerow);

        container.appendChild(body);
        container.className = 'setup_form';

        document.querySelector("#buttons-div").before(container);

        total_forms.value = parseInt(total_forms.value) + 1;
    }

    function delete_form(){
        let forms = document.querySelectorAll(".setup_form");
        if (forms.length > 1) {
            let last_form = forms[forms.length - 1];
            last_form.remove();
        }
    }

    function verify_not_empty_fields() {
        let campaign_name_inputs = document.querySelectorAll("input[id*=campaign_name]");
        let audience_inputs = document.querySelectorAll("input[id*=audience]");
        let schedule_inputs = document.querySelectorAll("input[id*=schedule]");
        let count = 0;
        campaign_name_inputs.forEach(input => {
            let value = input.value;
            if (value != "") {
                count++;
            }
        });
        console.log(count);
        if (count == campaign_name_inputs.length) {
            able_submit_button();
        } else if (count < campaign_name_inputs.length) {
            disable_submit_button();
        }
    }

    function able_submit_button() {
        let submit_button = document.querySelector("button[type=submit]");
        submit_button.removeAttribute('disabled');
    }

    function disable_submit_button() {
        let submit_button = document.querySelector("button[type=submit]");
        submit_button.setAttribute('disabled','disabled');
    }

    let form = document.querySelector("form");
    form.addEventListener('change', verify_not_empty_fields, false);

    let inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('change', verify_not_empty_fields, false);
    });


</script>
{% endblock content %}